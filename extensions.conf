[public]
exten => s,1,NoOp(UNRECOGNIZED INCOMING)
same => n,Hangup

[recogn_record]
exten => _X.,1,NoOp(RECORDING)
;same => n,MixMonitor(/tmp/record.wav)
;same => n,Answer
;same => n,Record(/tmp/recognition:ulaw,,120,k)
;same => n,EAGI(/opt/python/eagi-en.py)
;same => n,Return

exten => s,1,NoOp(RECORDING)
same => n,Set(amd=0)
same => n,NoOp(${CHANNEL(state)})
;same => n,MixMonitor(/tmp/record.wav)
;same => n,Answer
;same => n,Record(/tmp/recognition:ulaw,,120,k)
same => n,NoOp("SC:${HASH(SIP_CAUSE,${CDR(channel)})}")
same => n,NoOp("HC:${HANGUPCAUSE}")
same => n,EAGI(/opt/python/eagi-en.py)
same => n,NoOp("AMD:"${amd})
same => n,NoOp("BS:${CDR(billsec)}")
same => n,NoOp("DR:${CDR(duration)}")
same => n,NoOp("CS:${CHANNEL(state)}")
;same => n,Hangup
same => n,Return

[from_inftel]
exten => _X.,1,NoOp(INFINITY INCOMING)
same => n,Progress
same => n,MusicOnHold
same => n,Hangup

exten => s,1,NoOp(INFINITY INCOMING)
same => n,Progress
;same => n,MusicOnHold
same => n,Hangup

exten => 4917666993768,1,NoOp(INFINITY RECOGN)
same => n,Hangup

[from_dzinga]
exten => _X.,1,NoOp(DZINGA INCOMING)
;same => n,Progress
same => n,Answer
same => n,MusicOnHold
same => n,Hangup

exten => s,1,NoOp(DZINGA INCOMING)
same => n,Answer
same => n,Progress
same => n,MusicOnHold
same => n,Hangup

[call_is_answered]
exten => s,1,NoOp(CALL HAS ANSWERED)
same => n,Return

[from_stage]
; Case UUID Call
exten => _000000.,1,NoOp(Case UUID Call)
same => n,Set(WPNUM=${SHELL(/opt/scripts/getnumbycuid.stage.py ${EXTEN} | tr -d '\n')})
;same => n,Hangup
same => n,GotoIf($["${WPNUM}"!="0"]?from_naumen,${WPNUM},1)
same => n,Hangup

exten => _X.,1,NoOp(HANGUP)
same => n,GoTo(from_naumen,${EXTEN},1)
same => n,Hangup

[from_naumen]
; TEST CALL TO STAGE
exten => _12121212,1,NoOp(TEST CALL)
same => n,Set(CALLERID(all)=79998786423)
same => n,Dial(SIP/naumen-stage/004)
same => n,Hangup

; Case UUID Call
exten => _000000.,1,NoOp(Case UUID Call)
same => n,Set(CASEID=${EXTEN})
same => n,Set(WPNUM=${SHELL(/opt/scripts/getnumbycuid.py ${EXTEN} | tr -d '\n')})
same => n,GotoIf($["${WPNUM}"!="0"]?${WPNUM},1)
same => n,Hangup

; Wrapped Number Call
exten => _XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX.,1,NoOp(Wrapped Number Direction)
same => n,GoSub(nfsrec,${EXTEN},1)
same => n,Set(WPNUM=${SHELL(/opt/scripts/unwrapnum.py ${EXTEN} | tr -d '\n')})
same => n,GotoIf($["${WPNUM}"!="0"]?${WPNUM},1)
same => n,Hangup

; Belarus call
exten => _375.,1,NoOp(Belarus)
same => n,Set(CALLERID(all)=74954490100)
;same => n,Dial(SIP/inftel/001${EXTEN})
same => n,Hangup

; Dominicana call
exten => _18X.,1,NoOp(Dominicana)
same => n,Set(CALLERID(all)=18499365594)
same => n,Dial(SIP/br-bgt-pbx/${EXTEN})
same => n,Hangup

; Costa Rica call
exten => _506X.,1,NoOp(Dominicana)
same => n,Set(CALLERID(all)=50641023901)
same => n,Dial(SIP/br-bgt-pbx/${EXTEN})
same => n,Hangup

;exten => _79036530004,1,NoOp(Test Call)
;same => n,Set(CALLERID(all)=74954490100)
;same => n,Dial(SIP/inftel/001${EXTEN})
;same => n,Hangup
;=======

;========= PBX ECHO TEST
exten => _12345678,1,NoOp(ECHO TEST)
same => n,Playback(echo-test)
same => n,Playback(beep)
same => n,Set(RECORDNAME=/tmp/ECHOTEST-${UNIQUEID})
same => n,Record(${RECORDNAME}.ogg,,5)
same => n,Playback(${RECORDNAME})
same => n,Hangup

exten => _420720664482,1,NoOp(CZECH CHECK)
same => n,Set(CALLERID(all)=420290000228)
;same => n,Dial(SIP/inftel/099${EXTEN})
same => n,Hangup

;;======== AMD TEST ========================
;exten => _359887465399,1,NoOp(IVALID NUMBER)
;same => n,Set(CALLERID(all)=359896163135)
;same => n,Progress()
;same => n,Dial(SIP/dzinga/${EXTEN})
;same => n,NoOp(${DIALSTATUS})
;same => n,NoOp(${HANGUPCAUSE})
;same => n,Hangup

;exten => _359887989632,1,NoOp(UNDELIVERABLE)
;same => n,Set(CALLERID(all)=359896163135)
;same => n,Progress()
;same => n,Dial(SIP/dzinga/${EXTEN})
;same => n,NoOp(${DIALSTATUS})
;same => n,NoOp(${HANGUPCAUSE})
;same => n,Hangup

;======== SPEEDNET TEST

;exten => _34900400922,1,NoOp(SPEEDNET TEST)
;same => n,Set(CALLERID(all)=34910602236)
;same => n,Dial(SIP/speednet/02${EXTEN})

exten => _393667341705,1,NoOp(GELEV TEST)
same => n,Set(CALLERID(all)=390697632464)
same => n,Dial(SIP/gelev/${EXTEN})
same => n,Hangup

;======== RUSSIAN TEST

exten => _7XXXXXXXXXX,1,NoOp(RUSSIA)
same => n,Set(CALLERID(all)=74955590100)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,Hangup

;======== HUNGARY DST =======================

exten => _+36XXXXXXXX,1,GoTo(hungary,${EXTEN:1},1)
exten => _0036XXXXXXXX,1,GoTo(hungary,${EXTEN:2},1)
exten => _36XXXXXXXX,1,GoTo(hungary,${EXTEN},1)

exten => _+36XXXXXXXXX,1,GoTo(hungary,${EXTEN:1},1)
exten => _0036XXXXXXXXX,1,GoTo(hungary,${EXTEN:2},1)
exten => _36XXXXXXXXX,1,GoTo(hungary,${EXTEN},1)

exten => _+36XXXXXXXXXX,1,GoTo(hungary,${EXTEN:1},1)
exten => _0036XXXXXXXXXX,1,GoTo(hungary,${EXTEN:2},1)
exten => _36XXXXXXXXXX,1,GoTo(hungary,${EXTEN},1)

exten => _+36XXXXXXXXXXX,1,GoTo(hungary,${EXTEN:1},1)
exten => _0036XXXXXXXXXXX,1,GoTo(hungary,${EXTEN:2},1)
exten => _36XXXXXXXXXXX,1,GoTo(hungary,${EXTEN},1)

exten => _36X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== ESTONIA DST =======================

exten => _+372XXXXXXX,1,GoTo(estonia,${EXTEN:1},1)
exten => _00372XXXXXXX,1,GoTo(estonia,${EXTEN:2},1)
exten => _372XXXXXXX,1,GoTo(estonia,${EXTEN},1)

exten => _+372XXXXXXXX,1,GoTo(estonia,${EXTEN:1},1)
exten => _00372XXXXXXXX,1,GoTo(estonia,${EXTEN:2},1)
exten => _372XXXXXXXX,1,GoTo(estonia,${EXTEN},1)

exten => _+372XXXXXXXXX,1,GoTo(estonia,${EXTEN:1},1)
exten => _00372XXXXXXXXX,1,GoTo(estonia,${EXTEN:2},1)
exten => _372XXXXXXXXX,1,GoTo(estonia,${EXTEN},1)

exten => _+372XXXXXXXXXX,1,GoTo(estonia,${EXTEN:1},1)
exten => _00372XXXXXXXXXX,1,GoTo(estonia,${EXTEN:2},1)
exten => _372XXXXXXXXXX,1,GoTo(estonia,${EXTEN},1)

exten => _372X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== PORTUGAL DST =======================

exten => _+351XXXXXXXXX,1,GoTo(portugal,${EXTEN:1},1)
exten => _00351XXXXXXXXX,1,GoTo(portugal,${EXTEN:2},1)
exten => _351XXXXXXXXX,1,GoTo(portugal,${EXTEN},1)

exten => _351X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== ITALY DST =======================
exten => _+39XXXXXXXXXXXX,1,GoTo(italy,${EXTEN:1},1)
exten => _0039XXXXXXXXXXXX,1,GoTo(italy,${EXTEN:2},1)
exten => _39XXXXXXXXXXXX,1,GoTo(italy,${EXTEN},1)

exten => _+39XXXXXXXXXXX,1,GoTo(italy,${EXTEN:1},1)
exten => _0039XXXXXXXXXXX,1,GoTo(italy,${EXTEN:2},1)
exten => _39XXXXXXXXXXX,1,GoTo(italy,${EXTEN},1)

exten => _+39XXXXXXXXXX,1,GoTo(italy,${EXTEN:1},1)
exten => _0039XXXXXXXXXX,1,GoTo(italy,${EXTEN:2},1)
exten => _39XXXXXXXXXX,1,GoTo(italy,${EXTEN},1)

exten => _+39XXXXXXXXX,1,GoTo(italy,${EXTEN:1},1)
exten => _0039XXXXXXXXX,1,GoTo(italy,${EXTEN:2},1)
exten => _39XXXXXXXXX,1,GoTo(italy,${EXTEN},1)

exten => _+39XXXXXXXX,1,GoTo(italy,${EXTEN:1},1)
exten => _0039XXXXXXXX,1,GoTo(italy,${EXTEN:2},1)
exten => _39XXXXXXXX,1,GoTo(italy,${EXTEN},1)

exten => _+39XXXXXXX,1,GoTo(italy,${EXTEN:1},1)
exten => _0039XXXXXXX,1,GoTo(italy,${EXTEN:2},1)
exten => _39XXXXXXX,1,GoTo(italy,${EXTEN},1)

exten => _+39XXXXXX,1,GoTo(italy,${EXTEN:1},1)
exten => _0039XXXXXX,1,GoTo(italy,${EXTEN:2},1)
exten => _39XXXXXX,1,GoTo(italy,${EXTEN},1)
    
exten => _+39XXXXX,1,GoTo(italy,${EXTEN:1},1)
exten => _0039XXXXX,1,GoTo(italy,${EXTEN:2},1)
exten => _39XXXXX,1,GoTo(italy,${EXTEN},1)

exten => _+39XXXX,1,GoTo(italy,${EXTEN:1},1)
exten => _0039XXXX,1,GoTo(italy,${EXTEN:2},1)
exten => _39XXXX,1,GoTo(italy,${EXTEN},1)

exten => _39X.,1,NoOp(WRONG CALL)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== AUSTRIA DST =======================

exten => _+43XXXXXXXXXXXXX,1,GoTo(austria,${EXTEN:1},1)
exten => _0043XXXXXXXXXXXXX,1,GoTo(austria,${EXTEN:2},1)
exten => _43XXXXXXXXXXXXX,1,GoTo(austria,${EXTEN},1)

exten => _+43XXXXXXXXXXXX,1,GoTo(austria,${EXTEN:1},1)
exten => _0043XXXXXXXXXXXX,1,GoTo(austria,${EXTEN:2},1)
exten => _43XXXXXXXXXXXX,1,GoTo(austria,${EXTEN},1)

exten => _+43XXXXXXXXXXX,1,GoTo(austria,${EXTEN:1},1)
exten => _0043XXXXXXXXXXX,1,GoTo(austria,${EXTEN:2},1)
exten => _43XXXXXXXXXXX,1,GoTo(austria,${EXTEN},1)

exten => _+43XXXXXXXXXX,1,GoTo(austria,${EXTEN:1},1)
exten => _0043XXXXXXXXXX,1,GoTo(austria,${EXTEN:2},1)
exten => _43XXXXXXXXXX,1,GoTo(austria,${EXTEN},1)

exten => _+43XXXXXXXXX,1,GoTo(austria,${EXTEN:1},1)
exten => _0043XXXXXXXXX,1,GoTo(austria,${EXTEN:2},1)
exten => _43XXXXXXXXX,1,GoTo(austria,${EXTEN},1)

exten => _+43XXXXXXXX,1,GoTo(austria,${EXTEN:1},1)
exten => _0043XXXXXXXX,1,GoTo(austria,${EXTEN:2},1)
exten => _43XXXXXXXX,1,GoTo(austria,${EXTEN},1)

exten => _+43XXXXXXX,1,GoTo(austria,${EXTEN:1},1)
exten => _0043XXXXXXX,1,GoTo(austria,${EXTEN:2},1)
exten => _43XXXXXXX,1,GoTo(austria,${EXTEN},1)

exten => _43X.,1,NoOp(WRONG CALL)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== BELGIUM DST =======================
exten => _+32XXXXXXXX,1,GoTo(belgium,${EXTEN:1},1)
exten => _+32XXXXXXXXX,1,GoTo(belgium,${EXTEN:1},1)
exten => _0032XXXXXXXXX,1,GoTo(belgium,${EXTEN:2},1)
exten => _0032XXXXXXXX,1,GoTo(belgium,${EXTEN:2},1)
exten => _32XXXXXXXX,1,GoTo(belgium,${EXTEN},1)
exten => _32XXXXXXXXX,1,GoTo(belgium,${EXTEN},1)

exten => _32X.,1,NoOp(WRONG CALL)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== SLOVAKIA DST =======================

exten => _+421XXXXXXXXXXXX,1,GoTo(slovakia,${EXTEN:1},1)
exten => _00421XXXXXXXXXXXX,1,GoTo(slovakia,${EXTEN:2},1)
exten => _421XXXXXXXXXXXX,1,GoTo(slovakia,${EXTEN},1)

exten => _+421XXXXXXXXXXX,1,GoTo(slovakia,${EXTEN:1},1)
exten => _00421XXXXXXXXXXX,1,GoTo(slovakia,${EXTEN:2},1)
exten => _421XXXXXXXXXXX,1,GoTo(slovakia,${EXTEN},1)

exten => _+421XXXXXXXXXX,1,GoTo(slovakia,${EXTEN:1},1)
exten => _00421XXXXXXXXXX,1,GoTo(slovakia,${EXTEN:2},1)
exten => _421XXXXXXXXXX,1,GoTo(slovakia,${EXTEN},1)

exten => _+421XXXXXXXXX,1,GoTo(slovakia,${EXTEN:1},1)
exten => _00421XXXXXXXXX,1,GoTo(slovakia,${EXTEN:2},1)
exten => _421XXXXXXXXX,1,GoTo(slovakia,${EXTEN},1)

exten => _+421XXXXXXXX,1,GoTo(slovakia,${EXTEN:1},1)
exten => _00421XXXXXXXX,1,GoTo(slovakia,${EXTEN:2},1)
exten => _421XXXXXXXX,1,GoTo(slovakia,${EXTEN},1)

exten => _+421XXXXXXX,1,GoTo(slovakia,${EXTEN:1},1)
exten => _00421XXXXXXX,1,GoTo(slovakia,${EXTEN:2},1)
exten => _421XXXXXXX,1,GoTo(slovakia,${EXTEN},1)

exten => _421X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== BULGARIA DST ===================

exten => _+359XXXXXXXX,1,GoTo(bulgaria,${EXTEN:1},1)
exten => _00359XXXXXXXX,1,GoTo(bulgaria,${EXTEN:2},1)
exten => _359XXXXXXXX,1,GoTo(bulgaria,${EXTEN},1)

exten => _+359XXXXXXXXX,1,GoTo(bulgaria,${EXTEN:1},1)
exten => _00359XXXXXXXXX,1,GoTo(bulgaria,${EXTEN:2},1)
exten => _359XXXXXXXXX,1,GoTo(bulgaria,${EXTEN},1)

exten => _+359XXXXXXXXXX,1,GoTo(bulgaria,${EXTEN:1},1)
exten => _00359XXXXXXXXXX,1,GoTo(bulgaria,${EXTEN:2},1)
exten => _359XXXXXXXXXX,1,GoTo(bulgaria,${EXTEN},1)

exten => _359X.,1,NoOp(WRONG CALL)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== SPAIN DST =======================
exten => _+34XXXXXXXXXXX,1,GoTo(spain,${EXTEN:1},1)
exten => _0034XXXXXXXXXXX,1,GoTo(spain,${EXTEN:2},1)
exten => _34XXXXXXXXXXX,1,GoTo(spain,${EXTEN},1)

exten => _+34XXXXXXXXXX,1,GoTo(spain,${EXTEN:1},1)
exten => _0034XXXXXXXXXX,1,GoTo(spain,${EXTEN:2},1)
exten => _34XXXXXXXXXX,1,GoTo(spain,${EXTEN},1)

exten => _+34XXXXXXXXX,1,GoTo(spain,${EXTEN:1},1)
exten => _0034XXXXXXXXX,1,GoTo(spain,${EXTEN:2},1)
exten => _34XXXXXXXXX,1,GoTo(spain,${EXTEN},1)

exten => _34X.,1,NoOp(WRONG CALL)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== LATVIA DST =======================
exten => _+371XXXXXXXX,1,GoTo(latvia,${EXTEN:1},1)
exten => _00371XXXXXXXX,1,GoTo(latvia,${EXTEN:2},1)
exten => _371XXXXXXXX,1,GoTo(latvia,${EXTEN},1)

exten => _371X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== ROMANIA DST =======================
exten => _+40XXXXXXXXXXXX,1,GoTo(romania,${EXTEN:1},1)
exten => _0040XXXXXXXXXXXX,1,GoTo(romania,${EXTEN:2},1)
exten => _40XXXXXXXXXXXX,1,GoTo(romania,${EXTEN},1)

exten => _+40XXXXXXXXXXX,1,GoTo(romania,${EXTEN:1},1)
exten => _0040XXXXXXXXXXX,1,GoTo(romania,${EXTEN:2},1)
exten => _40XXXXXXXXXXX,1,GoTo(romania,${EXTEN},1)

exten => _+40XXXXXXXXXX,1,GoTo(romania,${EXTEN:1},1)
exten => _0040XXXXXXXXXX,1,GoTo(romania,${EXTEN:2},1)
exten => _40XXXXXXXXXX,1,GoTo(romania,${EXTEN},1)

exten => _+40XXXXXXXXX,1,GoTo(romania,${EXTEN:1},1)
exten => _0040XXXXXXXXX,1,GoTo(romania,${EXTEN:2},1)
exten => _40XXXXXXXXX,1,GoTo(romania,${EXTEN},1)

exten => _40X.,1,NoOp(WRONG CALL)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== POLAND DST =======================

exten => _+48XXXXXXXXX,1,GoTo(poland,${EXTEN:1},1)
exten => _0048XXXXXXXXX,1,GoTo(poland,${EXTEN:2},1)
exten => _48XXXXXXXXX,1,GoTo(poland,${EXTEN},1)

exten => _+48XXXXXXXX,1,GoTo(poland,${EXTEN:1},1)
exten => _0048XXXXXXXX,1,GoTo(poland,${EXTEN:2},1)
exten => _48XXXXXXXX,1,GoTo(poland,${EXTEN},1)

exten => _48X.,1,NoOp(WRONG CALL)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== CZECH DST =======================
exten => _+420XXXXXXXXX,1,GoTo(czech,${EXTEN:1},1)
exten => _00420XXXXXXXXX,1,GoTo(czech,${EXTEN:2},1)
exten => _420XXXXXXXXX,1,GoTo(czech,${EXTEN},1)

exten => _420X.,1,NoOp(WRONG CALL)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== SWISS DST =======================

exten => _+41XXXXXXXXX,1,GoTo(swiss,${EXTEN:1},1)
exten => _0041XXXXXXXXX,1,GoTo(swiss,${EXTEN:2},1)
exten => _41XXXXXXXXX,1,GoTo(swiss,${EXTEN},1)

exten => _41X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== FRANCE DST =======================

exten => _+33XXXXXXXXX,1,GoTo(france,${EXTEN:1},1)
exten => _0033XXXXXXXXX,1,GoTo(france,${EXTEN:2},1)
exten => _33XXXXXXXXX,1,GoTo(france,${EXTEN},1)

exten => _+33XXXXXXXXXX,1,GoTo(france,${EXTEN:1},1)
exten => _0033XXXXXXXXXX,1,GoTo(france,${EXTEN:2},1)
exten => _33XXXXXXXXXX,1,GoTo(france,${EXTEN},1)

exten => _+33XXXXXXXXXXX,1,GoTo(france,${EXTEN:1},1)
exten => _0033XXXXXXXXXXX,1,GoTo(france,${EXTEN:2},1)
exten => _33XXXXXXXXXXX,1,GoTo(france,${EXTEN},1)

exten => _33X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup


;======== SWEDEN DST =======================

exten => _+46XXXXXXXXXXXX,1,GoTo(sweden,${EXTEN:1},1)
exten => _0046XXXXXXXXXXXX,1,GoTo(sweden,${EXTEN:2},1)
exten => _46XXXXXXXXXXXX,1,GoTo(sweden,${EXTEN},1)

exten => _+46XXXXXXXXXXX,1,GoTo(sweden,${EXTEN:1},1)
exten => _0046XXXXXXXXXXX,1,GoTo(sweden,${EXTEN:2},1)
exten => _46XXXXXXXXXXX,1,GoTo(sweden,${EXTEN},1)

exten => _+46XXXXXXXXXX,1,GoTo(sweden,${EXTEN:1},1)
exten => _0046XXXXXXXXXX,1,GoTo(sweden,${EXTEN:2},1)
exten => _46XXXXXXXXXX,1,GoTo(sweden,${EXTEN},1)

exten => _+46XXXXXXXXX,1,GoTo(sweden,${EXTEN:1},1)
exten => _0046XXXXXXXXX,1,GoTo(sweden,${EXTEN:2},1)
exten => _46XXXXXXXXX,1,GoTo(sweden,${EXTEN},1)

exten => _+46XXXXXXXX,1,GoTo(sweden,${EXTEN:1},1)
exten => _0046XXXXXXXX,1,GoTo(sweden,${EXTEN:2},1)
exten => _46XXXXXXXX,1,GoTo(sweden,${EXTEN},1)

exten => _+46XXXXXXX,1,GoTo(sweden,${EXTEN:1},1)
exten => _0046XXXXXXX,1,GoTo(sweden,${EXTEN:2},1)
exten => _46XXXXXXX,1,GoTo(sweden,${EXTEN},1)

exten => _46X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== GERMANY DST =======================

;exten => _4949XXXXXXXXX.,1,GoTo(germany,${EXTEN:2},1)

exten => _+49XXXXXXXXXXXXX,1,GoTo(germany,${EXTEN:1},1)
exten => _0049XXXXXXXXXXXXX,1,GoTo(germany,${EXTEN:2},1)
exten => _49XXXXXXXXXXXXX,1,GoTo(germany,${EXTEN},1)

exten => _+49XXXXXXXXXXXX,1,GoTo(germany,${EXTEN:1},1)
exten => _0049XXXXXXXXXXXX,1,GoTo(germany,${EXTEN:2},1)
exten => _49XXXXXXXXXXXX,1,GoTo(germany,${EXTEN},1)

exten => _+49XXXXXXXXXXX,1,GoTo(germany,${EXTEN:1},1)
exten => _0049XXXXXXXXXXX,1,GoTo(germany,${EXTEN:2},1)
exten => _49XXXXXXXXXXX,1,GoTo(germany,${EXTEN},1)

exten => _+49XXXXXXXXXX,1,GoTo(germany,${EXTEN:1},1)
exten => _0049XXXXXXXXXX,1,GoTo(germany,${EXTEN:2},1)
exten => _49XXXXXXXXXX,1,GoTo(germany,${EXTEN},1)

exten => _+49XXXXXXXXX,1,GoTo(germany,${EXTEN:1},1)
exten => _0049XXXXXXXXX,1,GoTo(germany,${EXTEN:2},1)
exten => _49XXXXXXXXX,1,GoTo(germany,${EXTEN},1)

exten => _+49XXXXXXXX,1,GoTo(germany,${EXTEN:1},1)
exten => _0049XXXXXXXX,1,GoTo(germany,${EXTEN:2},1)
exten => _49XXXXXXXX,1,GoTo(germany,${EXTEN},1)

exten => _+49XXXXXXX,1,GoTo(germany,${EXTEN:1},1)
exten => _0049XXXXXXX,1,GoTo(germany,${EXTEN:2},1)
exten => _49XXXXXXX,1,GoTo(germany,${EXTEN},1)

exten => _+49XXXXXX,1,GoTo(germany,${EXTEN:1},1)
exten => _0049XXXXXX,1,GoTo(germany,${EXTEN:2},1)
exten => _49XXXXXX,1,GoTo(germany,${EXTEN},1)

exten => _49X.,1,NoOp(WRONG CALL)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== COLOMBIA DST =======================

exten => _+57XXXXXXXX,1,GoTo(colombia,${EXTEN:1},1)
exten => _0057XXXXXXXX,1,GoTo(colombia,${EXTEN:2},1)
exten => _57XXXXXXXX,1,GoTo(colombia,${EXTEN},1)

exten => _+57XXXXXXXXX,1,GoTo(colombia,${EXTEN:1},1)
exten => _0057XXXXXXXXX,1,GoTo(colombia,${EXTEN:2},1)
exten => _57XXXXXXXXX,1,GoTo(colombia,${EXTEN},1)

exten => _+57XXXXXXXXXX,1,GoTo(colombia,${EXTEN:1},1)
exten => _0057XXXXXXXXXX,1,GoTo(colombia,${EXTEN:2},1)
exten => _57XXXXXXXXXX,1,GoTo(colombia,${EXTEN},1)

exten => _57X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== BRASILIA DST =======================

exten => _+55XXXXXXXX,1,GoTo(brasil,${EXTEN:1},1)
exten => _0055XXXXXXXX,1,GoTo(brasil,${EXTEN:2},1)
exten => _55XXXXXXXX,1,GoTo(brasil,${EXTEN},1)

exten => _+55XXXXXXXXX,1,GoTo(brasil,${EXTEN:1},1)
exten => _0055XXXXXXXXX,1,GoTo(brasil,${EXTEN:2},1)
exten => _55XXXXXXXXX,1,GoTo(brasil,${EXTEN},1)

exten => _+55XXXXXXXXXXX,1,GoTo(brasil,${EXTEN:1},1)
exten => _0055XXXXXXXXXXX,1,GoTo(brasil,${EXTEN:2},1)
exten => _55XXXXXXXXXXX,1,GoTo(brasil,${EXTEN},1)

exten => _+55XXXXXXXXXXXX,1,GoTo(brasil,${EXTEN:1},1)
exten => _0055XXXXXXXXXXXX,1,GoTo(brasil,${EXTEN:2},1)
exten => _55XXXXXXXXXXXX,1,GoTo(brasil,${EXTEN},1)

exten => _55X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== PERU DST =======================

exten => _+51XXXXXXXX,1,GoTo(peru,${EXTEN:1},1)
exten => _0051XXXXXXXX,1,GoTo(peru,${EXTEN:2},1)
exten => _51XXXXXXXX,1,GoTo(peru,${EXTEN},1)

exten => _+51XXXXXXXXX,1,GoTo(peru,${EXTEN:1},1)
exten => _0051XXXXXXXXX,1,GoTo(peru,${EXTEN:2},1)
exten => _51XXXXXXXXX,1,GoTo(peru,${EXTEN},1)

exten => _51X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== NIGERIA DST =======================

exten => _+234XXXXXXXXXXX,1,GoTo(nigeria,${EXTEN:1},1)
exten => _00234XXXXXXXXXXX,1,GoTo(nigeria,${EXTEN:2},1)
exten => _234XXXXXXXXXXX,1,GoTo(nigeria,${EXTEN},1)

exten => _+234XXXXXXXXXX,1,GoTo(nigeria,${EXTEN:1},1)
exten => _00234XXXXXXXXXX,1,GoTo(nigeria,${EXTEN:2},1)
exten => _234XXXXXXXXXX,1,GoTo(nigeria,${EXTEN},1)

exten => _+234XXXXXXXXX,1,GoTo(nigeria,${EXTEN:1},1)
exten => _00234XXXXXXXXX,1,GoTo(nigeria,${EXTEN:2},1)
exten => _234XXXXXXXXX,1,GoTo(nigeria,${EXTEN},1)

exten => _+234XXXXXXXX,1,GoTo(nigeria,${EXTEN:1},1)
exten => _00234XXXXXXXX,1,GoTo(nigeria,${EXTEN:2},1)
exten => _234XXXXXXXX,1,GoTo(nigeria,${EXTEN},1)

exten => _+234XXXXXXX,1,GoTo(nigeria,${EXTEN:1},1)
exten => _0023XXXXXXXX,1,GoTo(nigeria,${EXTEN:2},1)
exten => _234XXXXXXX,1,GoTo(nigeria,${EXTEN},1)

exten => _+234XXXXXX,1,GoTo(nigeria,${EXTEN:1},1)
exten => _0023XXXXXXX,1,GoTo(nigeria,${EXTEN:2},1)
exten => _234XXXXXX,1,GoTo(nigeria,${EXTEN},1)

exten => _234X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== MEXICO DST =======================

exten => _+52XXXXXXXXXX,1,GoTo(mexico,${EXTEN:1},1)
exten => _0052XXXXXXXXXX,1,GoTo(mexico,${EXTEN:2},1)
exten => _52XXXXXXXXXX,1,GoTo(mexico,${EXTEN},1)

exten => _52X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== EQUADOR DST =======================

exten => _+593XXXXXXX,1,GoTo(equador,${EXTEN:1},1)
exten => _00593XXXXXXX,1,GoTo(equador,${EXTEN:2},1)
exten => _593XXXXXXX,1,GoTo(equador,${EXTEN},1)

exten => _+593XXXXXXXX,1,GoTo(equador,${EXTEN:1},1)
exten => _00593XXXXXXXX,1,GoTo(equador,${EXTEN:2},1)
exten => _593XXXXXXXX,1,GoTo(equador,${EXTEN},1)

exten => _+593XXXXXXXXX,1,GoTo(equador,${EXTEN:1},1)
exten => _00593XXXXXXXXX,1,GoTo(equador,${EXTEN:2},1)
exten => _593XXXXXXXXX,1,GoTo(equador,${EXTEN},1)

exten => _593X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== PANAMA DST =======================

exten => _+507XXXXXXX,1,GoTo(panama,${EXTEN:1},1)
exten => _00507XXXXXXX,1,GoTo(panama,${EXTEN:2},1)
exten => _507XXXXXXX,1,GoTo(panama,${EXTEN},1)

exten => _+507XXXXXXXX,1,GoTo(panama,${EXTEN:1},1)
exten => _00507XXXXXXXX,1,GoTo(panama,${EXTEN:2},1)
exten => _507XXXXXXXX,1,GoTo(panama,${EXTEN},1)


;======== CHILE DST =======================
exten => _+56XXXXXXXXX,1,GoTo(chile,${EXTEN:1},1)
exten => _0056XXXXXXXXX,1,GoTo(chile,${EXTEN:2},1)
exten => _56XXXXXXXXX,1,GoTo(chile,${EXTEN},1)

exten => _+56XXXXXXXX,1,GoTo(chile,${EXTEN:1},1)
exten => _0056XXXXXXXX,1,GoTo(chile,${EXTEN:2},1)
exten => _56XXXXXXXX,1,GoTo(chile,${EXTEN},1)

exten => _+5611X.,1,Hangup
exten => _005611X.,1,Hangup
exten => _5611X.,1,Hangup

exten => _+56115X.,1,Hangup
exten => _005615X.,1,Hangup
exten => _5615X.,1,Hangup

exten => _+562X.,1,Hangup
exten => _00562X.,1,Hangup
exten => _562X.,1,Hangup

exten => _+563X.,1,Hangup
exten => _00563X.,1,Hangup
exten => _563X.,1,Hangup

exten => _+564X.,1,Hangup
exten => _00564X.,1,Hangup
exten => _564X.,1,Hangup

exten => _+565X.,1,Hangup
exten => _00565X.,1,Hangup
exten => _565X.,1,Hangup

exten => _+566X.,1,Hangup
exten => _00566X.,1,Hangup
exten => _566X.,1,Hangup

exten => _+567X.,1,Hangup
exten => _00567X.,1,Hangup
exten => _567X.,1,Hangup

exten => _56X.,1,NoOp(WRONG CALL)
same => n,Answer
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,Hangup

;======== RUSSIA DST ======================
exten => _7X.,1,NoOp(OUTGOING RUSSIA CALL)
same => n,Set(CALLERID(all)=34910602236)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,Set(DESTINATION=${EXTEN})
same => n,Progress()
same => n,MixMonitor(${CALLFILENAME})
;same => n,Dial(SIP/inftel/001${EXTEN}) ;; For testing porpose only
;;; Failover mode ;;;
same => n,NoOp(${DIALSTATUS})
same => n,ExecIf($[${DIALSTATUS}=ANSWERED]?Hangup)
same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/gelev/${EXTEN})
same => n,NoOp(${DIALSTATUS})
same => n,ExecIf($[${DIALSTATUS}=ANSWERED]?Hangup)
same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,NoOp(${DIALSTATUS})
same => n,Hangup(${HANGUPCAUSE})

;exten => 79036530004,1,NoOp(RUSSIA CALL)
;same => n,Dial(SIP/gelev/${EXTEN})
;same => n,GoTo(gelev_route,${EXTEN},1)

;exten => h,1,Set(CDR(userfield)=${HANGUPCAUSE})

exten => h,1,NoOp(${DIALSTATUS})
same => n,NoOp(${DESTINATION})
same => n,NoOp(${CDR(billsec)})
;same => n,GosubIf($[$[${DIALSTATUS}=BUSY]|$[${DIALSTATUS}=CANCEL]]&[${CDR(billsec)=0}]?hlrchk,${DESTINATION},1)

exten => _7XXXXXXXX,1,NoOp(UNVALID NUM)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _6XXXXXXXX,1,NoOp(UNVALID NUM)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

[progress]
exten => s,1,NoOp(PROGRESS MODE)
same => n,Progress()
same => n,return

[hlrchk]
;exten => _X.,1,NoOp(HLR CHECK PHONE NUMBER)
;same => n,Set(NUMISVALID=${SHELL(/opt/scripts/hlrcheck.py ${EXTEN} | tr -d '\n')})
;same => n,NoOp(${NUMISVALID})
;same => n,Set(PROTOEXEC=/opt/scripts/dummy.py | tr -d '\n'))
;same => n,ExecIf($[${NUMISVALID}=1]?Set(PROTOEXEC=/opt/scripts/protomark.py ${EXTEN} | tr -d '\n'))
;same => n,NoOp(${PROTOEXEC})
;same => n,ExecIf($[${NUMISVALID}=1]?Set(PROTOMARK=${SHELL(${PROTOEXEC})}))
;;same => n,ExecIf($[${NUMISVALID}=1]?Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')}))
;same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
;same => n,return

[causecodecheck]
exten => _X.,1,NoOp(SET INVALID BY 19 CAUSE CODE)
;same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')}))
;same => n,NoOp(PROTOCRM ANSWER: ${PROTOMARK})
same => n,return

[invmark]
exten => _X.,1,NoOp(MARK INVALID BY q.850 0x1)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,return

[hangup_process]
exten => _X.,1,NoOp(HANGUP PROCESSING)
same => n,NoOp(${HANGUPCAUSE})
same => n,Hangup

[baretest]
;======== AMD TEST ========================

[chkhangupproc]
exten => _X.,1,NoOp(PROCESS VALIDATION CHECK)
same => n,NoOp(HC: ${HANGUPCAUSE})
same => n,NoOp(DS: ${DIALSTATUS})

[phonecheck]
exten => _X.,1,NoOp(PREPARE PHONE CHECK)
same => n,NoOp(${EXTEN})
same => n,NoOp(${NAUDNIS})
same => n,Set(CHECKISVALID=${SHELL(/opt/scripts/dialcheck.py ${EXTEN} ${NAUDNIS} ${CALLERID(num)} | tr -d '\n')})

[checkproc]
exten => _X.,1,NoOp(PHONE DIALCHECK)
same => n,Set(CALLERID(all)=420290000228)
same => n,Set(CLD=${EXTEN})
;same => n,Dial(SIP/inftel/099${EXTEN},300,L(0))
;same => n,Set(${CALLERID(all)}=${CLID})
same => n,NoOp(${DNIS})
same => n,Hangup

exten => h,1,NoOp(Q931 VALIDATE)
same => n,NoOp(HCC: ${HANGUPCAUSE})
same => n,Gosubif($[${HANGUPCAUSE}=1]?invmark,${CLD},1)
same => n,Return

;exten => failed,1,NoOp(CALL FAIL)
;same => n,NoOp(${CAUSECODE})

;======== MOLDOVA CALLING CONTEXT =======================
[moldova]
exten => _373X.,1,NoOp(OUTGOING MOLDOVA CALL)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,Set(DESTINATION=${EXTEN})
same => n,MixMonitor(${CALLFILENAME})
same => n,Set(CALLERID(all)=35932545013)
same => n,Dial(SIP/dzinga/${EXTEN})
exten => _381X.,1,NoOp(OUTGOING SERBIA CALL)
same => n,Set(CALLERID(all)=35932545013)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,HangUp


;======== HUNGARY CALLING CONTEXT =======================
[hungary]
exten => _36X.,1,NoOp(OUTGOING HUNGARY CALL)
same => n,Set(DESTINATION=${EXTEN})
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))




same => n,Set(RS=${RAND(0,2)})
same => n,Set(CALLERID(all)=36303859906)
same => n,ExecIf($[ "${RS}"="1" ]?Set(CALLERID(all)=36307263277))
same => n,ExecIf($[ "${RS}"="2" ]?Set(CALLERID(all)=36307352260))
same => n,Dial(SIP/inftel/001${EXTEN})


same => n,NoOp(Check if wrong)
same => n,Set(CALLERID(all)=3613009257)
same => n,Dial(SIP/dzinga/${EXTEN})

same => n,NoOp(${DIALSTATUS})

same => n,Set(INFHC=${HANGUPCAUSE})
;;; phone validation
same => n,Set(HC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))

;same => n,Set(CALLERID(all)=36212010089)
same => n,Dial(SIP/speednet/${EXTEN})

same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)
;same => n,ExecIf($[${EXISTS(${DIALSTATUS})}]?Set(DSTAT=${DIALSTATUS}):Set(DSTAT=FAILED))
;same => n,NoOp(STATUS:${DIALSTATUS})
;same => n,NoOp(DST:${DESTINATION})
;same => n,NoOp(BILLSEC:${CDR(billsec)})
;same => n,NoOp(CAUSECODE:${HANGUPCAUSE})
;same => n,Set(R1=$[$[${DSTAT}=BUSY]|$[${DSTAT}=CANCEL]])
;same => n,Set(R2=$[$[${CDR(billsec)}=0]&$[${HANGUPCAUSE}!=404]&$[${HANGUPCAUSE}!=200]&[${CDR(duration)}>5]])
;same => n,GosubIf($[${R1}&${R2}]?hlrchk,${DESTINATION},1)

;======== ESTONIA CALLING CONTEXT =======================
[estonia]
exten => _372X.,1,NoOp(OUTGOING ESTONIA CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
;same => n,Set(NUMISVALID=${SHELL(/opt/scripts/chkiswrong.py ${EXTEN} | tr -d '\n')})
;same => n,ExecIf($[${NUMISVALID}=1]?Hangup(404))
same => n,Set(CALLERID(all)=3726346155)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,NoOp(${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})
;;; phone validation
;same => n,Set(HC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))
;;; Failover mode ;;;
same => n,Set(CALLERID(all)=3726346334)
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))	
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
;same => n,Dial(SIP/gelev/${EXTEN})
same => n,NoOp(${DIALSTATUS})

same => n,Set(CALLERID(all)=3726346334)
same => n,Dial(SIP/speednet/${EXTEN})

same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)
;same => n,ExecIf($[${EXISTS(${DIALSTATUS})}]?Set(DSTAT=${DIALSTATUS}):Set(DSTAT=FAILED))
;same => n,NoOp(STATUS:${DIALSTATUS})
;same => n,NoOp(DST:${DESTINATION})
;same => n,NoOp(BILLSEC:${CDR(billsec)})
;same => n,NoOp(CAUSECODE:${HANGUPCAUSE})
;same => n,Set(R1=$[$[${DSTAT}=BUSY]|$[${DSTAT}=CANCEL]])
;same => n,Set(R2=$[$[${CDR(billsec)}=0]&$[${HANGUPCAUSE}!=404]&$[${HANGUPCAUSE}!=200]&[${CDR(duration)}>5]])
;same => n,GosubIf($[${R1}&${R2}]?hlrchk,${DESTINATION},1)

;======== PORTUGAL CALLING CONTEXT =======================
[portugal]
exten => _351X.,1,NoOp(OUTGOING PORTUGAL CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))


same => n,NoOp(Check if wrong)
same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=351300528123)
same => n,ExecIf($[ "${RS}"="1" ]?Set(CALLERID(all)=351308800839))
same => n,Dial(SIP/dzinga/${EXTEN},30,g)


same => n,NoOp(Check if wrong)
same => n,Set(CALLERID(all)=351912050278)
same => n,Dial(SIP/inftel/001${EXTEN},30,g)

same => n,Set(CALLERID(all)=351300528123)
same => n,Dial(SIP/a1-telecom/${EXTEN},30,g)

same => n,Hangup

exten => h,1,NoOp(HANGUP)

;======== NIGERIA CALLING CONTEXT =======================
[nigeria]
exten => _234X.,1,NoOp(OUTGOING NIGERIA CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
same => n,Progress()
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

same => n,Set(RS=${RAND(0,4)})
same => n,Set(CALLERID(all)=2347001235378)
same => n,ExecIf($[ "${RS}"="1" ]?Set(CALLERID(all)=2347001235379))
same => n,ExecIf($[ "${RS}"="2" ]?Set(CALLERID(all)=2347001235380))
same => n,ExecIf($[ "${RS}"="3" ]?Set(CALLERID(all)=2347001235381))
same => n,ExecIf($[ "${RS}"="4" ]?Set(CALLERID(all)=2347001235382))
same => n,Dial(SIP/miatel/${EXTEN})


same => n,Set(CALLERID(all)=23415151344)
same => n,Dial(SIP/a1-telecom/${EXTEN},60,g)


;same => n,Set(CALLERID(all)=23407065236126)
same => n,Set(CALLERID(all)=48222674315)
;same => n,Dial(SIP/dzinga/${EXTEN})
same => n,Hangup



exten => h,1,NoOp(HANGUP)

;======== ITALY CALLING CONTEXT =======================
[italy]
exten => _39X.,1,NoOp(OUTGOING ITALY CALL)
same => n,Set(DESTINATION=${EXTEN})

same => n,NoOp(${CALLERID(num)})
same => n,GoToIf($[${CALLERID(num)}=393512938371]?italystudy,${EXTEN},1)
same => n,Set(DESTINATION=${EXTEN})

; = Check call count
;same => n,Set(EX=${SHELL(/opt/scripts/chkcount.sh ${EXTEN}|tr -d '\n')})
;same => n,NoOp(CALLCOUNT: ${EX})
;same => n,ExecIf( $[ "${EX}"="1" ]?Hangup )
; ==

;same => n,Answer

;same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
;same => n,Progress

same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
same => n,Set(CHANNEL(hangup_handler_push)=recognize_it,${EXTEN},1)


same => n,NoOp(${HANGUPCAUSE})
same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=393512359175)
same => n,ExecIf($[ "${RS}"="1" ]?Set(CALLERID(all)=393511929960))
same => n,Dial(SIP/inftel/001${EXTEN})



same => n,Set(CALLERID(all)=390683464994)
same => n,Dial(SIP/dzinga/${EXTEN})


;;; phone validation
same => n,Set(INFHC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))

same => n,Set(CALLERID(all)=393509926274)
same => n,Dial(SIP/speednet/${EXTEN})
;;==========================

;;; AMD detection
;same => n,GosubIf($["${DIALSTATUS}"="NO ANSWER"]?amdproc,${EXTEN},1)
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)
;same => n,ExecIf($[${EXISTS(${DIALSTATUS})}]?Set(DSTAT=${DIALSTATUS}):Set(DSTAT=FAILED))
;same => n,NoOp(STATUS:${DIALSTATUS})
;same => n,NoOp(DST:${DESTINATION})
;same => n,NoOp(BILLSEC:${CDR(billsec)})
;same => n,NoOp(CAUSECODE:${HANGUPCAUSE})
;same => n,Set(R1=$[$[${DSTAT}=BUSY]|$[${DSTAT}=CANCEL]])
;same => n,Set(R2=$[$[${CDR(billsec)}=0]&$[${HANGUPCAUSE}!=404]&$[${HANGUPCAUSE}!=200]&[${CDR(duration)}>5]])
;same => n,GosubIf($[${R1}&${R2}]?hlrchk,${DESTINATION},1)

;======== ITALY STUDY CONTEXT
[italystudy]
exten => _X.,1,NoOp(italy study call)
same => n,Set(CALLERID(all)=393509313789)
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,Hangup

;======== AUSTRIA CALLING CONTEXT =======================
[austria]
exten => _43X.,1,NoOp(OUTGOING AUSTRIA CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

same => n,NoOp(Check if wrong)
same => n,Set(CALLERID(all)=43720775392)
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,NoOp(${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})

same => n,Set(CALLERID(all)=43720111062)
same => n,NoOp(${DIALSTATUS})
same => n,Dial(SIP/dzinga/${EXTEN})

same => n,Hangup

exten => h,1,NoOp(HANGUP)

;======== SLOVAKIA CALLING CONTEXT =======================
[slovakia]
exten => _421X.,1,NoOp(OUTGOING SLOVAKIA CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
same => n,Set(NUMISVALID=${SHELL(/opt/scripts/chkiswrong.py ${EXTEN} | tr -d '\n')})
;same => n,ExecIf($[${NUMISVALID}=1]?Hangup(404))
;same => n,Set(CALLERID(all)=421233322937)
same => n,Set(CALLERID(all)=421233325116)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,NoOp(${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})
;;; phone validation
same => n,Set(HC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))
;;; Failover mode ;;;
same => n,Set(CALLERID(all)=421233322937)
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
;same => n,Dial(SIP/gelev/${EXTEN})
same => n,NoOp(${DIALSTATUS})

same => n,Set(CALLERID(all)=421233322937)
same => n,Dial(SIP/speednet/${EXTEN})

same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)
;same => n,ExecIf($[${EXISTS(${DIALSTATUS})}]?Set(DSTAT=${DIALSTATUS}):Set(DSTAT=FAILED))
;same => n,NoOp(STATUS:${DIALSTATUS})
;same => n,NoOp(DST:${DESTINATION})
;same => n,NoOp(BILLSEC:${CDR(billsec)})
;same => n,NoOp(CAUSECODE:${HANGUPCAUSE})
;same => n,Set(R1=$[$[${DSTAT}=BUSY]|$[${DSTAT}=CANCEL]])
;same => n,Set(R2=$[$[${CDR(billsec)}=0]&$[${HANGUPCAUSE}!=404]&$[${HANGUPCAUSE}!=200]&[${CDR(duration)}>5]])
;same => n,GosubIf($[${R1}&${R2}]?hlrchk,${DESTINATION},1)

;======== BULGARIA CALLING CONTEXT =======================
[bulgaria]
exten => _3592484[56]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _35956934X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _35990069X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _359X.,1,NoOp(OUTGOING BULGARIA CALL)
same => n,Set(NAUDNIS=${CALLERID(num)})
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

;same => n,NoOp(Check if wrong)
;same => n,Set(NUMISVALID=${SHELL(/opt/scripts/chkiswrong.py ${EXTEN} | tr -d '\n')})
;same => n,ExecIf($[${NUMISVALID}=1]?Hangup(404))

;same => n,Set(CHANNEL(hangup_handler_push)=hangup_proc_inf,${EXTEN},1)

same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=35929060628)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=35929060746))
same => n,Dial(SIP/a1-telecom/${EXTEN},30)


same => n,Set(RS=${RAND(0,2)})
same => n,Set(CALLERID(all)=35924904479)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=35924904463))
same => n,ExecIf($[ "${RS}"="2"]?Set(CALLERID(all)=35924950571))
;same => n,ExecIf($[ "${RS}"="3"]?Set(CALLERID(all)=35924903358))
same => n,Dial(SIP/inftel/001${EXTEN})


;same => n,Set(CALLERID(all)=35924915302)
;same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
;same => n,Dial(SIP/dzinga/${EXTEN})

;;; phone validation
same => n,Set(HC=${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))
;;; Failover mode ;;;
same => n,Set(CALLERID(all)=35924928861)

same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
same => n,Dial(SIP/speednet/${EXTEN})

same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)

;======== SPAIN CALLING CONTEXT =======================
[spain]
exten => _345X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _341[02]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _34100[589]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _3412[34]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _34803[0-5]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _34806[0-5]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _34807[0-5]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _3490[1-58]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _34X.,1,NoOp(OUTGOING SPAIN CALL)
same => n,Set(DESTINATION=${EXTEN})

same => n,Answer

;same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
;same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
;same => n,Set(NUMISVALID=${SHELL(/opt/scripts/chkiswrong.py ${EXTEN} | tr -d '\n')})
;same => n,ExecIf($[${NUMISVALID}=1]?Hangup(404))
;same => n,Set(MAINCID=${CALLERID(num)})
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

; DZINGA ;;
same => n,Set(RS=${RAND(0,7)})
same => n,Set(CALLERID(all)=34950387833)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=34951498774))
same => n,ExecIf($[ "${RS}"="2"]?Set(CALLERID(all)=34951498771))
same => n,ExecIf($[ "${RS}"="3"]?Set(CALLERID(all)=34950387821))
same => n,ExecIf($[ "${RS}"="4"]?Set(CALLERID(all)=34951406811))
same => n,ExecIf($[ "${RS}"="5"]?Set(CALLERID(all)=34951390928))
same => n,ExecIf($[ "${RS}"="6"]?Set(CALLERID(all)=34951390559))
same => n,ExecIf($[ "${RS}"="7"]?Set(CALLERID(all)=34950387831))
same => n,Dial(SIP/dzinga/${EXTEN})


same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=34613392139)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=34613392132))
same => n,Dial(SIP/inftel/001${EXTEN})

same => n,Set(RS=${RAND(0,3)})
same => n,Set(CALLERID(all)=34642973297)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=34642973939))
same => n,ExecIf($[ "${RS}"="2"]?Set(CALLERID(all)=34642974715))
same => n,ExecIf($[ "${RS}"="3"]?Set(CALLERID(all)=34642940891))
same => n,Dial(SIP/a1-telecom/${EXTEN})


;same => n,NoOp(${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})

;;;; phone validation
;same => n,Set(HC=${HANGUPCAUSE})
;;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;;same => n,ExecIf($[${HC}=19]?Hangup(406))
;same => n,Set(IHC=${HANGUPCAUSE})
;;same => n,GosubIf($[${IHC}=1]?checkproc,${EXTEN},1)
;same => n,ExecIf($[${IHC}=1]?Hangup(404))

same => n,Set(CALLERID(all)=34911219812)
same => n,Dial(SIP/speednet/${EXTEN})

;;;;; DZINGA ;;;
;same => n,Set(RS=${RAND(0,5)})
;same => n,Set(CALLERID(all)=34604514071)
;same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=34910606913))
;same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=34910606897))
;same => n,ExecIf($[ "${RS}"="2"]?Set(CALLERID(all)=34910602498))
;same => n,ExecIf($[ "${RS}"="3"]?Set(CALLERID(all)=34910606897))
;same => n,ExecIf($[ "${RS}"="4"]?Set(CALLERID(all)=34910603281))
;same => n,ExecIf($[ "${RS}"="5"]?Set(CALLERID(all)=34910603279))
;same => n,Dial(SIP/dzinga/${EXTEN})
;;;;======================

;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
same => n,NoOp(${DIALSTATUS})
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)
;same => n,GosubIf($["${DIALSTATUS}"="NO ANSWER"]?longdial,${DESTINATION},1)
;same => n,ExecIf($[${EXISTS(${DIALSTATUS})}]?Set(DSTAT=${DIALSTATUS}):Set(DSTAT=FAILED))
;same => n,NoOp(STATUS:${DIALSTATUS})
;same => n,NoOp(DST:${DESTINATION})
;same => n,NoOp(BILLSEC:${CDR(billsec)})
;same => n,NoOp(CAUSECODE:${HANGUPCAUSE})
;same => n,Set(R1=$[$[${DSTAT}=BUSY]|$[${DSTAT}=CANCEL]])
;same => n,Set(R2=$[$[${CDR(billsec)}=0]&$[${HANGUPCAUSE}!=404]&$[${HANGUPCAUSE}!=200]&[${CDR(duration)}>5]])
;same => n,GosubIf($[${R1}&${R2}]?hlrchk,${DESTINATION},1)

;======== LATVIA CALLING CONTEXT =======================
[latvia]
exten => _371X.,1,NoOp(OUTGOING LATVIA CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
;same => n,Set(NUMISVALID=${SHELL(/opt/scripts/chkiswrong.py ${EXTEN} | tr -d '\n')})
;same => n,ExecIf($[${NUMISVALID}=1]?Hangup(404))
same => n,Set(CALLERID(all)=37167660785)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,NoOp(${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})
;;; phone validation
same => n,Set(HC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))
;;; Failover mode ;;;
same => n,Set(CALLERID(all)=37167870130)
same => n,NoOp(${DIALSTATUS})
same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/gelev/${EXTEN})
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))

same => n,Set(CALLERID(all)=37167870130)
same => n,Dial(SIP/speednet/${EXTEN})

same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)

;======== ROMANIA CALLING CONTEXT =======================
[romania]

exten => _4078[0-3]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _4078[89]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _40312499X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _4033751X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _4033851X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _4033951X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _4034951X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _409X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _40900010X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _40906010X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _40900000X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _40903000X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _40906000X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _40118X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _40971X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _40X.,1,NoOp(OUTGOING ROMANIA CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

same => n,Set(RS=${RAND(0,2)})
same => n,Set(CALLERID(all)=40736789695)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=40736789681))
same => n,ExecIf($[ "${RS}"="2"]?Set(CALLERID(all)=40736790427))
same => n,Dial(SIP/inftel/001${EXTEN})


same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=40312289379)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=40312289339))
same => n,Dial(SIP/dzinga/${EXTEN})


same => n,NoOp(${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})
;;; phone validation
same => n,Set(HC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))
;;; Failover mode ;;;

;same => n,Set(CALLERID(all)=46812410374)
;same => n,Dial(SIP/speednet/${EXTEN})

;same => n,Set(CALLERID(all)=40312289336)
same => n,Set(CALLERID(all)=40312289374)
same => n,Dial(SIP/dzinga/${EXTEN})


same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)
;same => n,ExecIf($[${EXISTS(${DIALSTATUS})}]?Set(DSTAT=${DIALSTATUS}):Set(DSTAT=FAILED))
;same => n,NoOp(STATUS:${DIALSTATUS})
;same => n,NoOp(DST:${DESTINATION})
;same => n,NoOp(BILLSEC:${CDR(billsec)})
;same => n,NoOp(CAUSECODE:${HANGUPCAUSE})
;same => n,Set(R1=$[$[${DSTAT}=BUSY]|$[${DSTAT}=CANCEL]])
;same => n,Set(R2=$[$[${CDR(billsec)}=0]&$[${HANGUPCAUSE}!=404]&$[${HANGUPCAUSE}!=200]&[${CDR(duration)}>5]])
;same => n,GosubIf($[${R1}&${R2}]?hlrchk,${DESTINATION},1)

;======== POLAND CALLING CONTEXT =======================
[poland]
exten => _4873993X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _4870000[10]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _4857953X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _4857942X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _48333335X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _482574090X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _48221988[98]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _48221889X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _48221180X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _48221138X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _48X.,1,NoOp(OUTGOING POLAND CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
;same => n,Set(NUMISVALID=${SHELL(/opt/scripts/chkiswrong.py ${EXTEN} | tr -d '\n')})
;same => n,ExecIf($[${NUMISVALID}=1]?Hangup(404))
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

same => n,Set(RS=${RAND(0,2)})
same => n,Set(CALLERID(all)=48732221949)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=48732221950))
same => n,ExecIf($[ "${RS}"="2"]?Set(CALLERID(all)=48732221951))
same => n,NoOp(${DIALSTATUS})
same => n,Dial(SIP/dzinga/${EXTEN})


same => n,Set(RS=${RAND(0,2)})
same => n,Set(CALLERID(all)=48510604980)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=48510824532))
same => n,ExecIf($[ "${RS}"="2"]?Set(CALLERID(all)=48510738233))
same => n,Dial(SIP/inftel/001${EXTEN})


same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=48597221433)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=48718808487))
same => n,Dial(SIP/a1-telecom/${EXTEN},30,g)

same => n,NoOp(${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})
;;; phone validation
same => n,Set(HC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))
;;; Failover mode ;;;
same => n,Set(CALLERID(all)=48222674372)
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))	
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
;same => n,Dial(SIP/gelev/${EXTEN})
same => n,NoOp(${DIALSTATUS})

same => n,Dial(SIP/speednet/${EXTEN})

;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)
;same => n,ExecIf($[${EXISTS(${DIALSTATUS})}]?Set(DSTAT=${DIALSTATUS}):Set(DSTAT=FAILED))
;same => n,NoOp(STATUS:${DIALSTATUS})
;same => n,NoOp(DST:${DESTINATION})
;same => n,NoOp(BILLSEC:${CDR(billsec)})
;same => n,NoOp(CAUSECODE:${HANGUPCAUSE})
;same => n,Set(R1=$[$[${DSTAT}=BUSY]|$[${DSTAT}=CANCEL]])
;same => n,Set(R2=$[$[${CDR(billsec)}=0]&$[${HANGUPCAUSE}!=404]&$[${HANGUPCAUSE}!=200]&[${CDR(duration)}>5]])
;same => n,GosubIf($[${R1}&${R2}]?hlrchk,${DESTINATION},1)

;======== CZECH CALLING CONTEXT =======================
[czech]

exten => _42084[0-2]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _42084[7-9]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _42090[069]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup


exten => _420X.,1,NoOp(OUTGOING CZECH CALL)
same => n,NoOp(${CALLERID(num)})
same => n,GoToIf($[${CALLERID(num)}=420290000416]?czechstudy,${EXTEN},1)
same => n,Set(DESTINATION=${EXTEN})

;; = Check call count
;same => n,Set(EX=${SHELL(/opt/scripts/chkcount.sh ${EXTEN}|tr -d '\n')})
;same => n,NoOp(CALLCOUNT: ${EX})
;same => n,ExecIf( $[ "${EX}"="1" ]?Hangup )
;; ==

;same => n,Answer

;same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
;same => n,Set(NUMISVALID=${SHELL(/opt/scripts/chkiswrong.py ${EXTEN} | tr -d '\n')})
;same => n,ExecIf($[${NUMISVALID}=1]?Hangup(404))
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

same => n,Set(RS=${RAND(0,6)})
same => n,Set(CALLERID(all)=420296183118)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=420237762114))
same => n,ExecIf($[ "${RS}"="2"]?Set(CALLERID(all)=420234093824))
same => n,ExecIf($[ "${RS}"="3"]?Set(CALLERID(all)=420237762198))
same => n,ExecIf($[ "${RS}"="4"]?Set(CALLERID(all)=420296182782))
same => n,ExecIf($[ "${RS}"="5"]?Set(CALLERID(all)=420237762110))
same => n,ExecIf($[ "${RS}"="6"]?Set(CALLERID(all)=420296249973))
same => n,Dial(SIP/inftel/001${EXTEN})

same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=420228889176)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=420228889175))
same => n,ExecIf($[ "${RS}"="2"]?Set(CALLERID(all)=420228889176))
same => n,NoOp(${DIALSTATUS})
same => n,Dial(SIP/dzinga/${EXTEN})


;;Failover 
;same => n,Set(CALLERID(all)=420234261776)
;same => n,NoOp(${DIALSTATUS})
;;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
;same => n,Dial(SIP/dzinga/${EXTEN})
;;===

same => n,NoOp(${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})
;;; phone validation
same => n,Set(HC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))
;;; Failover mode ;;;
same => n,Set(CALLERID(all)=420296399395)
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
;same => n,Dial(SIP/gelev/${EXTEN})
same => n,NoOp(${DIALSTATUS})

same => n,Dial(SIP/speednet/${EXTEN})

same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)
;same => n,ExecIf($[${EXISTS(${DIALSTATUS})}]?Set(DSTAT=${DIALSTATUS}):Set(DSTAT=FAILED))
;same => n,NoOp(STATUS:${DIALSTATUS})
;same => n,NoOp(DST:${DESTINATION})
;same => n,NoOp(BILLSEC:${CDR(billsec)})
;same => n,NoOp(CAUSECODE:${HANGUPCAUSE})
;same => n,Set(R1=$[$[${DSTAT}=BUSY]|$[${DSTAT}=CANCEL]])
;same => n,Set(R2=$[$[${CDR(billsec)}=0]&$[${HANGUPCAUSE}!=404]&$[${HANGUPCAUSE}!=200]&[${CDR(duration)}>5]])
;same => n,GosubIf($[${R1}&${R2}]?hlrchk,${DESTINATION},1)

;======== CZECH STUDY CONTEXT
[czechstudy]
exten => _42084[0-2]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _42084[7-9]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _42090[069]X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _X.,1,NoOp(czech study call)
same => n,Set(CALLERID(all)=420290000416)
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,Hangup

;======== SWISS CALLING CONTEXT =======================
[swiss]
exten => _41X.,1,NoOp(OUTGOING SWISS CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
;same => n,Set(NUMISVALID=${SHELL(/opt/scripts/chkiswrong.py ${EXTEN} | tr -d '\n')})
;same => n,ExecIf($[${NUMISVALID}=1]?Hangup(404))
same => n,Set(CALLERID(all)=41435500271)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,NoOp(${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})
;;; phone validation
same => n,Set(HC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))
;;; Failover mode ;;;
same => n,Set(CALLERID(all)=41435500271)
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/gelev/${EXTEN})
same => n,NoOp(${DIALSTATUS})

same => n,Dial(SIP/speednet/${EXTEN})

same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)
;same => n,ExecIf($[${EXISTS(${DIALSTATUS})}]?Set(DSTAT=${DIALSTATUS}):Set(DSTAT=FAILED))
;same => n,NoOp(STATUS:${DIALSTATUS})
;same => n,NoOp(DST:${DESTINATION})
;same => n,NoOp(BILLSEC:${CDR(billsec)})
;same => n,NoOp(CAUSECODE:${HANGUPCAUSE})
;same => n,Set(R1=$[$[${DSTAT}=BUSY]|$[${DSTAT}=CANCEL]])
;same => n,Set(R2=$[$[${CDR(billsec)}=0]&$[${HANGUPCAUSE}!=404]&$[${HANGUPCAUSE}!=200]&[${CDR(duration)}>5]])
;same => n,GosubIf($[${R1}&${R2}]?hlrchk,${DESTINATION},1)


;======== BELGIUM CALLING CONTEXT =======================
[belgium]

exten => _32X.,1,NoOp(OUTGOING BELGIUM CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
;same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,Answer()

same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

same => n,Set(RS=${RAND(0,2)})
same => n,Set(CALLERID(all)=32466904179)
same => n,ExecIf($["${RS}"="1"]?Set(CALLERID(all)=32466904180))
same => n,ExecIf($["${RS}"="2"]?Set(CALLERID(all)=32466904181))
same => n,Dial(SIP/dzinga/${EXTEN})



same => n,Set(RS=${RAND(0,2)})
same => n,Set(CALLERID(all)=3271158917)
same => n,ExecIf($["${RS}"="1"]?Set(CALLERID(all)=3271158916))
same => n,ExecIf($["${RS}"="2"]?Set(CALLERID(all)=3228997432))
same => n,Dial(SIP/a1-telecom/${EXTEN})



same => n,Set(RS=${RAND(0,2)})
same => n,Set(CALLERID(all)=3228081968)
same => n,ExecIf($["${RS}"="1"]?Set(CALLERID(all)=3228081984))
same => n,ExecIf($["${RS}"="2"]?Set(CALLERID(all)=3228085389))
same => n,Dial(SIP/speednet/${EXTEN})


same => n,Hangup

;======== FRANCE CALLING CONTEXT =======================
[france]
;exten => _3363800X.,1,NoOp(FRAUD)
;same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
;same => n,Hangup

;exten => _3363806X.,1,NoOp(FRAUD)
;same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
;;same => n,Hangup

;exten => _3364000X.,1,NoOp(FRAUD)
;same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
;same => n,Hangup

;exten => _3364001X.,1,NoOp(FRAUD)
;same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
;same => n,Hangup

;exten => _3364002X.,1,NoOp(FRAUD)
;same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
;same => n,Hangup

;exten => _3364003X.,1,NoOp(FRAUD)
;same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
;same => n,Hangup

;exten => _3364004X.,1,NoOp(FRAUD)
;same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
;same => n,Hangup

exten => _33X.,1,NoOp(OUTGOING FRANCE CALL)
same => n,Set(DESTINATION=${EXTEN})

same => n,Answer

;same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
;same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=33647806511)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=33647808775))
same => n,Dial(SIP/inftel/001${EXTEN},30,g)

same => n,Set(RS=${RAND(0,2)})
same => n,Set(CALLERID(all)=33973050346)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=33973051088))
same => n,ExecIf($[ "${RS}"="2"]?Set(CALLERID(all)=33973038581))
same => n,Dial(SIP/dzinga/${EXTEN},30,g)

same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=33647808903)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=33647808927))
same => n,Dial(SIP/speednet/${EXTEN},30,g)

same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=33176277943)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=33176277942))
same => n,Dial(SIP/a1-telecom/${EXTEN})

exten => h,1,NoOp(HANGUP)

;======== SWEDEN CALLING CONTEXT =======================
[sweden]

exten => _4610X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _4677X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _46X.,1,NoOp(OUTGOING SWEDEN CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,Answer

same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
;same => n,Set(NUMISVALID=${SHELL(/opt/scripts/chkiswrong.py ${EXTEN} | tr -d '\n')})
;same => n,ExecIf($[${NUMISVALID}=1]?Hangup(404))
same => n,Set(CALLERID(all)=46812410955)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,NoOp(${HANGUPCAUSE})
same => n,Set(INFHC=${HANGUPCAUSE})
;;; phone validation
same => n,Set(HC=${HANGUPCAUSE})
;same => n,GosubIf($[${HC}=19]?causecodecheck,${EXTEN},1)
;same => n,ExecIf($[${HC}=19]?Hangup(406))
;;; Failover mode ;;;
same => n,Set(CALLERID(all)=46812410955)
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,ExecIf($[${DIALSTATUS}=BUSY]?Hangup)
same => n,Dial(SIP/gelev/${EXTEN})
same => n,NoOp(${DIALSTATUS})

same => n,Dial(SIP/speednet/${EXTEN})

same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,GosubIf($[${INFHC}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=1]?invmark,${EXTEN},1)
;same => n,GosubIf($[${HANGUPCAUSE}=28]?invmark,${EXTEN},1)
same => n,Hangup

exten => h,1,NoOp(HANGUP)
;same => n,ExecIf($[${EXISTS(${DIALSTATUS})}]?Set(DSTAT=${DIALSTATUS}):Set(DSTAT=FAILED))
;same => n,NoOp(STATUS:${DIALSTATUS})
;same => n,NoOp(DST:${DESTINATION})
;same => n,NoOp(BILLSEC:${CDR(billsec)})
;same => n,NoOp(CAUSECODE:${HANGUPCAUSE})
;same => n,Set(R1=$[$[${DSTAT}=BUSY]|$[${DSTAT}=CANCEL]])
;same => n,Set(R2=$[$[${CDR(billsec)}=0]&$[${HANGUPCAUSE}!=404]&$[${HANGUPCAUSE}!=200]&[${CDR(duration)}>5]])
;same => n,GosubIf($[${R1}&${R2}]?hlrchk,${DESTINATION},1)

;======== GERMANY CALLING CONTEXT =======================
[germany]

exten => _4919X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _49X.,1,NoOp(OUTGOING GERMANY CALL)
same => n,Set(DESTINATION=${EXTEN})

same => n,Answer

;same => n,ExecIfTime(15:00-16:00?Gosub(doanswer,s,1))
;same => n,ExecIfTime(18:00-19:00?Gosub(doanswer,s,1))

same => n,NoOp(Check if wrong)
;same => n,Set(NUMISVALID=${SHELL(/opt/scripts/chkiswrong.py ${EXTEN} | tr -d '\n')})
;same => n,ExecIf($[${NUMISVALID}=1]?Hangup(404))

same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=4915774895655)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=4915774895664))
same => n,Dial(SIP/inftel/001${EXTEN})

;same => n,NoOp(${DIALSTATUS})
;same => n,ExecIf($[${DIALSTATUS}=ANSWER]?Hangup(200))
;same => n,Set(RS=${RAND(0,1)})
;same => n,Set(CALLERID(all)=498948402057)
;same => n,ExecIf($[ "${RS}"="1" ]?Set(CALLERID(all)=493042208065))
same => n,Set(CALLERID(all)=43720775392)
same => n,Dial(SIP/dzinga/${EXTEN})


same => n,Set(CALLERID(all)=4915227770917)
same => n,Dial(SIP/a1-telecom/${EXTEN})

same => n,Set(RS=${RAND(0,1)})
same => n,Set(CALLERID(all)=4915227877972)
same => n,ExecIf($[ "${RS}"="1"]?Set(CALLERID(all)=4915227768695))
same => n,Dial(SIP/speednet/${EXTEN})

same => n,Hangup

exten => h,1,NoOp(HANGUP)

;======== PERU CALLING CONTEXT =======================
[peru]
exten => _5118X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _514[1-4]8X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _515[1-46]8X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _516[1-7]8X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _517[2-6]8X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _518[2-4]8X.,1,NoOp(FRAUD)
same => n,Set(PROTOMARK=${SHELL(/opt/scripts/protomark.py ${EXTEN} | tr -d '\n')})
same => n,Hangup

exten => _51X.,1,NoOp(OUTGOING PERU CALL)
same => n,GoSub(doanswer,s,1)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
;same => n,Set(CALLERID(all)=5116429492)
same => n,Set(CALLERID(all)=5116419126)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,Hangup

;======== CHILE CALLING CONTEXT =======================
[chile]
exten => _56X.,1,NoOp(OUTGOING CHILE CALL)
same => n,GoSub(doanswer,s,1)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
same => n,Set(CALLERID(all)=56224053065)
same = n,Dial(SIP/dzinga/${EXTEN})
same => n,Hangup

;======== EQUADOR CALLING CONTEXT =======================
[equador]
exten => _593X.,1,NoOp(OUTGOING EQUADOR CALL)
same => n,GoSub(doanswer,s,1)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
;same => n,Set(CALLERID(all)=593963298724)
;same => n,Set(CALLERID(all)=593962723579)
same => n,Set(CALLERID(all)=593963360034)
;same => n,Dial(SIP/inftel/001${EXTEN})
same => n,Dial(SIP/br-bgt-pbx/${EXTEN})
same => n,Hangup

;======== COLOMBIA CALLING CONTEXT =======================
[colombia]
exten => _57X.,1,NoOp(OUTGOING COLOMBIA CALL)
same => n,GoSub(doanswer,s,1)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
same => n,Set(CALLERID(all)=573009122556)
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,Hangup

[mexico]
exten => _52X.,1,NoOp(mexico)
same => n,GoSub(doanswer,s,1)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})
same => n,Set(CALLERID(all)=525585262945)
same => n,Set(CALLERID(all)=525541708675)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,Hangup

[panama]
;5078338794 5078337546 5078388679
exten => _507X.,1,NoOp(OUTGOING COSTA RICA CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,ExecIfTime(12:00-13:00?Gosub(doanswer,s,1))
;same => n,ExecIfTime(17:00-18:00?Gosub(doanswer,s,1))
same => n,Answer()

same => n,NoOp(Check if wrong)
same => n,Set(CALLFILENAME=${STRFTIME(${EPOCH},,%Y-%m/%d/%H)}/${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
;same => n,MixMonitor(${CALLFILENAME})

same => n,Set(CALLERID(all)=5078338794)
;same => n,Dial(SIP/br-bgt-pbx/001${EXTEN},30)
same => n,Dial(SIP/br-bgt-pbx/${EXTEN},30)


[extpbx]
; TEST CALL TO STAGE
exten => _12121212,1,NoOp(TEST CALL)
same => n,Set(CALLERID(all)=79998786423)
same => n,Dial(SIP/naumen-stage/004)
same => n,Hangup

;exten => _573242999048,1,NoOp(EXT TEST)
;same => n,Playback(hello-world)
;same => n,Hangup

exten => _55X.,1,NoOp(BR)
;same => n,Set(CALLERID(all)=552120180264)
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,Set(CALLERID(all)=552140404528)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,Dial(SIP/inftel/001${EXTEN})

exten => _45X.,1,NoOp(Denmark)
same => n,Set(CALLERID(all)=4578723452)
same => n,Dial(SIP/dzinga/${EXTEN})

exten => _595X.,1,NoOp(Paragvai)
same => n,Set(CALLERID(all)=595217289094)
same => n,Dial(SIP/dzinga/${EXTEN})

exten => _18X.,1,NoOp(Dominicana)
same => n,Set(CALLERID(all)=18499365594)
same => n,Dial(SIP/br-bgt-pbx/${EXTEN})
same => n,Hangup

exten => _234X.,1,NoOp(Dominicana)
same => n,Set(CALLERID(all)=18499365594)
;same => n,Dial(SIP/br-bgt-pbx/${EXTEN})
same => n,GoTo(from_naumen,${EXTEN},1)
same => n,Hangup

exten => _506X.,1,NoOp(Dominicana)
same => n,Set(CALLERID(all)=50641023901)
same => n,Dial(SIP/br-bgt-pbx/${EXTEN})
same => n,Hangup

exten => _54X.,1,NoOp(argentina)
same => n,Set(CALLERID(all)=541139894084)
same => n,Dial(SIP/dzinga/${EXTEN})

exten => _591X.,1,NoOp(bolivia)
same => n,Set(CALLERID(all)=59150149174)
same => n,Dial(SIP/dzinga/${EXTEN})

exten => _552X.,1,NoOp(brazilian)
same => n,Set(CALLERID(all)=552120423828)
same => n,Dial(SIP/dzinga/${EXTEN})

exten => _56X.,1,NoOp(chile)
same => n,Set(CALLERID(all)=56224053065)
same = n,Dial(SIP/dzinga/${EXTEN})

exten => _52X.,1,NoOp(mexico)
same => n,Set(CALLERID(all)=525585262945)
same => n,Dial(SIP/dzinga/${EXTEN})

exten => _51X.,1,NoOp(PERU)
;same => n,Set(CallerID(all)=5116419108)
;same => n,Set(CALLERID(all)=552120180264)
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,Set(CALLERID(all)=5116429492)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,Dial(SIP/inftel/001${EXTEN})

exten => _57X.,1,NoOp(COL)
;same => n,Set(CALLERID(all)=552120180264)
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,Set(CALLERID(all)=5715800558)
same => n,Dial(SIP/br-bgt-pbx/${EXTEN})
;same => n,Dial(SIP/dzinga/${EXTEN})
;same => n,Dial(SIP/inftel/001${EXTEN})

exten => _1X.,1,NoOp(USA)
same => n,Set(CALLERID(all)=5715800558)
same => n,Dial(SIP/dzinga/${EXTEN})

exten => _X.,1,NoOp(EXTERNAL PBX CALL)
same => n,Set(DNUM=${FILTER(0-9,${EXTEN})})
same => n,Goto(from_naumen,${DNUM},1)

;======== MOLDOVA CALLING CONTEXT =======================
exten => _373X.,1,NoOp(OUTGOING MOLDOVA CALL)
same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,Set(DESTINATION=${EXTEN})
same => n,MixMonitor(${CALLFILENAME})
same => n,Set(CALLERID(all)=35932545013)
same => n,Dial(SIP/dzinga/${EXTEN})

exten => _381X.,1,NoOp(OUTGOING SERBIA CALL)
same => n,Set(CALLERID(all)=35932545013)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,HangUp

exten => _7XXXXXXXXXX,1,NoOp(RUSSIA)
same => n,Set(CALLERID(all)=74955590100)
same => n,Dial(SIP/dzinga/${EXTEN})
same => n,Dial(SIP/inftel/001${EXTEN})
same => n,Hangup

[bolivia]
exten => _591X.,1,NoOp(OUTGOING BOLIVIA CALL)
same => n,Set(DESTINATION=${EXTEN})

;same => n,ExecIfTime(12:00-13:00?Gosub(doanswer,s,1))
;same => n,ExecIfTime(17:00-18:00?Gosub(doanswer,s,1))
same => n,GoSub(doanswer,s,1)

same => n,NoOp(Check if wrong)
;same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,Set(CALLFILENAME=${STRFTIME(${EPOCH},,%Y-%m/%d/%H)}/${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,MixMonitor(${CALLFILENAME})

same => n,Set(CALLERID(all)=59150150802)
same => n,Dial(SIP/br-bgt-pbx/001${EXTEN})
same => n,NoOp(${HANGUPCAUSE})
same => n,Hangup

[dominicana]
;exten => _18X.,1,NoOp(OUTGOING BOLIVIA CALL)
;same => n,Set(DESTINATION=${EXTEN})

;same => n,ExecIfTime(12:00-13:00?Gosub(doanswer,s,1))
;same => n,ExecIfTime(17:00-18:00?Gosub(doanswer,s,1))
;same => n,GoSub(doanswer,s,1)

;same => n,NoOp(Check if wrong)
;same => n,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
;same => n,Set(CALLFILENAME=${STRFTIME(${EPOCH},,%Y-%m/%d/%H)}/${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
;same => n,MixMonitor(${CALLFILENAME})

;same => n,Set(CALLERID(all)=18499365594)
;same => n,Dial(SIP/br-bgt-pbx/001${EXTEN})
;same => n,NoOp(${HANGUPCAUSE})
;same => n,Hangup

[mediatest]
exten => _X.,1,Set(CALLFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
same => n,Set(DESTINATION=${EXTEN})
;same => n,GotoIf($["${EXTEN}" = "${CALLERID(num)}"]?media-test,${EXTEN},1)
same => n,MixMonitor(${CALLFILENAME})
same => n,Playback(/var/lib/asterisk/sounds/dualtone)
same => n,Hangup
;exten => _X.,1,Answer
;same => n,Playback(/var/lib/asterisk/sounds/cat)
;same => n,Hangup

[nfsrec]
exten => _X.,1,NoOp(RECORD TO NFS)
;same => n,Set(NFSDIRNAME=/mnt/nfs/${STRFTIME(${EPOCH},,%Y)}/${STRFTIME(${EPOCH},,%m)}/${STRFTIME(${EPOCH},,%d)}/${STRFTIME(${EPOCH},,%H)})
;same => n,Set(NFSFILENAME=${EXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID}.gsm)
;same => n,Set(RES=${SHELL(/usr/bin/mkdir -p ${NFSDIRNAME})})
;same => n,MixMonitor(${NFSDIRNAME}/${NFSFILENAME})
same => n,Return

[recognize_it]
exten => _X.,1,NoOp(RECOGNIZE SPEECH)
same => n,Set(WPNUM=${SHELL(/opt/scripts/getnumbycuid.stage.py ${EXTEN} | tr -d '\n')})
same => n,Agi(recogn.it.sh,${CALLFILENAME},${EXTEN},CID:${CASEID},${CDR(start)},${CDR(end)},"GMT+3",${UNIQUEID})
same => n,Return

;[btest]
;exten => _X.,1,NoOp(TELCO TEST)
;same => n,Set(CALLERID(all)=359896163135)
;same => n,Dial(SIP/dzinga/${EXTEN})
;same => n,NoOp(${DIALSTATUS})
;same => n,NoOp(${HANGUPCAUSE})
;same => n,Hangup

[income_local]
exten => _X.,1,NoOp(INCOMING FROM LOCAL PBX)
same => n,Wait(10)
same => n,Answer()
same => n,MusicOnHold()

[dialcheck]
exten => _X.,1,NoOp(DIAL CHECK)
same => n,Set(RES=${SHELL(echo ${EXTEN} >> /tmp/czech.answered)})
same => n,Hangup

[longdial]
exten => _X.,1,NoOp(TRY TO LONG DIAL)
same => n,Set(EX=${SHELL(/opt/longdial.sh ${EXTEN} ${MAINCID})})
same => n,Dial(SIP/inftel/001${EXTEN},120)
same => n,return

[doanswer]
exten => s,1,NoOp(ANSWER CALL)
same => n,Answer
same => n,Return

[amdproc]
exten => _X.,1,NoOp(ANSWERING MACHINE DETECTION BY MEDIA)
same => n,Set(NS=${SHELL(/opt/script/amd.sh ${CALLFILENAME})})
same => n,NoOp(AMD RESULT: ${NS})
same => n,Return
